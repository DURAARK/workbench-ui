{{duraark-preingest-steps session=session activeStep="geometricEnrichment"}}

<div class="l-page-with-header-and-workflow-steps">

  {{#if app.showLoadingSpinner}}
    {{loading-spinner-center}}
  {{/if}}

  <div class="c-workflow-page">
    {{workflow-step-header session=session onNext="next" onBack="back" app=app}}

    <div class="l-files">
      <div class="l-file-list">

        <h2 style="margin: 1em;"><i class="fa fa-building-o"></i>&nbsp; 3 | Add geometric enrichments:</h2>
        <hr>

        {{#if digitalObjects.length}}
          {{#file-list files=digitalObjects as |do|}}
            <div class="files-wrapper {{if do.isSelected "file-is-selected"}}">
              {{digital-object-sementic item=do select="showToolSelection"}}

              {{#each do.geoTools as |tool| }}
                {{#if (eq tool.label "Difference Detection")}}
                  {{diffdetection-tile tool=tool item=do infoClicked="showToolUI" remove="removeTool" }}
                {{else if (eq tool.label "Point Cloud Compression")}}
                  {{compression-tile tool=tool item=do infoClicked="showToolUI" remove="removeTool" }}
                {{else}}
                  {{tool-item tool=tool item=do infoClicked="showToolUI" remove="removeTool" }}
                {{/if}}
              {{/each}}
            </div>

            <hr>
          {{/file-list}}
        {{else}}
          <h3>To use the geometric enrichment tools at least one point cloud file (E57) has to be selected.</h3>
        {{/if}}
      </div>

      {{#if model}}
        <div class="l-file-details">

          {{#if app.showLoadingSpinner}}
            {{loading-spinner-center}}
          {{else}}

            {{#duraark-sidebar overflowYAuto=true}}
              {{#if tool}}
                {{#if isElectricalApplianceDetectionTool}}
                  {{#duraark-tool title="Detect Power Lines" close="closeToolUI" fullscreen="maximizeToolUI" }}
                    {{electrical-appliance tool=tool wallConfig=wallConfig}}
                  {{/duraark-tool}}
                {{/if}}

                {{#if isIFCReconstructionTool}}
                  {{#duraark-tool title="BIM Model" close="closeToolUI" fullscreen="maximizeToolUI" }}
                    {{ifc-reconstruction tool=tool onRetry="scheduleBIMReconstruction"}}
                  {{/duraark-tool}}
                {{/if}}

                {{#if isDifferenceDetectionTool}}
                  {{#duraark-tool title="BIM Model" close="closeToolUI" fullscreen="maximizeToolUI" }}
                    <h1>Difference Detection</h1>
                  {{/duraark-tool}}
                {{/if}}
              {{else}}
                {{#if selectedDigitalObject}}
                  {{tool-selector tools=tools click="clickedTool" icon="fa-building-o" title="Add geometric enrichments to the selected point cloud:"}}
                {{else}}
                  {{#help-box}}
                    <div class="c-help-box__hint">
                      For each 3D file you can apply tools which extract geometric information from the scan.
                      <br>
                      <br> Supported are
                      <br>
                      <br>

                      <ul style="margin-left: 1.5em;">
                        <li style="list-style-type: disc;">the reconstruction of a BIM model  (for E57 point clouds) and</li>
                        <li style="list-style-type: disc;">the detection of electrical applicances in walls (for E57 point clouds) and</li>
                        <li style="list-style-type: disc;">the difference detection between two files (for E57 and IFC files)/</li>
                      </ul>
                      <br>
                      <br> Use the <i class="fa fa-plus" style="margin-left: 0.5em; margin-right: 0.5em;"></i> sign on a point cloud file to add an geometric enrichment processing step. The resulting IFC file(s) will be stored in the archive.

                      <br>
                      <br> The 'Show Results <i class="fa fa-arrow-circle-o-right"></i>' button allows you to inspect the progress and the results of the respective tool. You can continue the pre-ingest workflow during the tool is working in the background.
                    </div>
                  {{/help-box}}
                {{/if}}
              {{/if}}
            {{/duraark-sidebar}}
          {{/if}}

        </div>
      {{/if}}
    </div>

  </div>
</div>
